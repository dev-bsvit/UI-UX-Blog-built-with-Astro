---
import { getCollection } from 'astro:content';
import LayoutWithSidebar from '../layouts/LayoutWithSidebar.astro';

// Отримуємо всі пости
const allPosts = await getCollection('posts');

// Групуємо пости за категоріями
const categories = allPosts.reduce((acc, post) => {
  const category = post.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(post);
  return acc;
}, {} as Record<string, typeof allPosts>);

const categoryColors = {
  'Дизайн': 'bg-blue-500',
  'Дослідження': 'bg-green-500',
  'Доступність': 'bg-purple-500',
  'Розробка': 'bg-orange-500',
};
---

<LayoutWithSidebar
  title="Категорії"
  description="Статті за категоріями"
  currentPath="/categories"
>
  <div>
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
        Категорії
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        Знайдіть статті за цікавими вам темами
      </p>
    </div>
    
    <!-- Категорії -->
    <div class="grid gap-6">
      {Object.entries(categories).map(([categoryName, posts]) => (
        <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center mb-4">
            <span class={`w-3 h-3 rounded-full mr-3 ${categoryColors[categoryName] || 'bg-gray-500'}`}></span>
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
              {categoryName}
            </h2>
            <span class="ml-auto text-sm text-gray-500 dark:text-gray-400">
              {posts.length} {posts.length === 1 ? 'стаття' : 'статей'}
            </span>
          </div>
          
          <div class="space-y-3">
            {posts.slice(0, 3).map((post) => (
              <a 
                href={`/posts/${post.slug}`}
                class="block p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              >
                <h3 class="font-medium text-gray-900 dark:text-white mb-1">
                  {post.data.title}
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
                  {post.data.excerpt || post.data.description}
                </p>
              </a>
            ))}
          </div>
          
          {posts.length > 3 && (
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <a 
                href={`/categories/${categoryName.toLowerCase()}`}
                class="text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 text-sm font-medium"
              >
                Показати всі {posts.length} статей →
              </a>
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</LayoutWithSidebar>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style> 