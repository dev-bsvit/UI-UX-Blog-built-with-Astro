---
import { getCollection } from 'astro:content';
import LayoutWithSidebar from '../layouts/LayoutWithSidebar.astro';

const posts = await getCollection('posts');

// Группируем посты по категориям
const postsByCategory = posts.reduce((acc, post) => {
  const category = post.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(post);
  return acc;
}, {} as Record<string, typeof posts>);

const categories = Object.keys(postsByCategory);

// Цвета для категорий
const categoryColors: Record<string, string> = {
  'Дизайн': 'bg-blue-500',
  'Дослідження': 'bg-green-500',
  'Доступність': 'bg-purple-500',
  'Розробка': 'bg-orange-500'
};

const seo = {
  title: 'Категорії | UI/UX Блог',
  description: 'Переглядайте статті за категоріями: дизайн, дослідження, доступність та розробка',
  image: '/og-image.jpg'
};
---

<LayoutWithSidebar seo={seo}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">
        Категорії
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        Знайдіть статті за темами, які вас цікавлять
      </p>
    </div>

    <div class="grid gap-6">
      {categories.map(categoryName => (
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <div class="flex items-center mb-4">
            <span class={`w-3 h-3 rounded-full mr-3 ${categoryColors[categoryName] || 'bg-gray-500'}`}></span>
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
              {categoryName}
            </h2>
            <span class="ml-auto text-sm text-gray-500 dark:text-gray-400">
              {postsByCategory[categoryName].length} статей
            </span>
          </div>
          
          <div class="grid gap-4">
            {postsByCategory[categoryName].slice(0, 3).map(post => (
              <article class="border-l-4 border-gray-200 dark:border-gray-700 pl-4">
                <h3 class="font-medium text-gray-900 dark:text-white mb-1">
                  <a href={`/posts/${post.slug}`} class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
                    {post.data.title}
                  </a>
                </h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">
                  {post.data.description}
                </p>
                <div class="flex items-center mt-2 text-xs text-gray-500 dark:text-gray-500">
                  <span>{post.data.author.name}</span>
                  <span class="mx-2">•</span>
                  <span>{post.data.readingTime}</span>
                </div>
              </article>
            ))}
          </div>
          
          {postsByCategory[categoryName].length > 3 && (
            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
              <a 
                href={`/categories/${categoryName.toLowerCase()}`}
                class="text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 text-sm font-medium transition-colors"
              >
                Переглянути всі статті в категорії →
              </a>
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</LayoutWithSidebar>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style> 